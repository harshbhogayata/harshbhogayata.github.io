<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Analyzer | Harsh Bhogayata</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Roboto+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-black text-gray-300 font-sans antialiased">
    <main class="pt-32 pb-20 container mx-auto px-6 max-w-6xl">

        <!-- Header -->
        <div class="flex items-center gap-4 mb-8 border-b border-green-500/20 pb-4">
            <a href="../tools.html" class="text-green-500 hover:text-white transition-colors">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 class="text-3xl font-bold text-white font-mono">
                <span class="text-purple-400">./</span>log_analyzer
            </h1>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Input Section -->
            <div class="lg:col-span-1 space-y-4">
                <div class="bg-gray-900/50 border border-gray-800 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-mono text-gray-500">RAW LOG INPUT (APACHE/NGINX)</label>
                        <button onclick="loadSample()" class="text-xs text-green-400 hover:text-white">Load
                            Sample</button>
                    </div>
                    <textarea id="log-input" rows="15"
                        class="w-full bg-black border border-gray-700 rounded p-2 text-xs font-mono text-gray-400 focus:border-purple-500 focus:outline-none"
                        placeholder="Paste log lines here..."></textarea>
                    <button onclick="analyzeLogs()"
                        class="w-full mt-4 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded transition-colors font-mono">
                        <i class="fas fa-microscope mr-2"></i>ANALYZE DATA
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div class="lg:col-span-2 space-y-6">

                <!-- Stats Row -->
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-gray-900/50 border border-green-500/20 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-white font-mono" id="stat-count">0</div>
                        <div class="text-xs text-gray-500">Total Requests</div>
                    </div>
                    <div class="bg-gray-900/50 border border-red-500/20 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-400 font-mono" id="stat-attacks">0</div>
                        <div class="text-xs text-gray-500">Threats Detected</div>
                    </div>
                    <div class="bg-gray-900/50 border border-blue-500/20 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-400 font-mono" id="stat-ips">0</div>
                        <div class="text-xs text-gray-500">Unique IPs</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="bg-gray-900/50 border border-gray-800 p-4 rounded-lg">
                    <h3 class="text-xs font-mono text-gray-500 mb-4">TRAFFIC DISTRIBUTION (STATUS CODES)</h3>
                    <div class="h-48">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>

                <!-- Attack Log -->
                <div class="bg-gray-900/50 border border-red-500/20 p-4 rounded-lg">
                    <h3 class="text-xs font-mono text-red-400 mb-4 flex items-center gap-2">
                        <i class="fas fa-shield-alt"></i> THREAT INTELLIGENCE
                    </h3>
                    <div id="threat-log" class="space-y-2 max-h-48 overflow-y-auto text-xs font-mono">
                        <div class="text-gray-500 italic">No threats detected yet.</div>
                    </div>
                </div>

            </div>

        </div>

    </main>

    <script src="../../js/main.js"></script>
    <script>
        let chartInstance = null;

        function loadSample() {
            const sample = `192.168.1.105 - - [19/Nov/2025:10:00:01 +0000] "GET /index.html HTTP/1.1" 200 1024
10.0.0.45 - - [19/Nov/2025:10:01:23 +0000] "POST /login HTTP/1.1" 401 532
192.168.1.105 - - [19/Nov/2025:10:02:00 +0000] "GET /admin.php HTTP/1.1" 403 204
45.33.22.11 - - [19/Nov/2025:10:05:00 +0000] "GET /search?q=<script>alert(1)<\\/script> HTTP/1.1" 200 3421
45.33.22.11 - - [19/Nov/2025:10:05:05 +0000] "GET /products?id=1' OR '1'='1 HTTP/1.1" 500 1204
192.168.1.105 - - [19/Nov/2025:10:06:10 +0000] "GET /images/logo.png HTTP/1.1" 200 40502
88.99.11.22 - - [19/Nov/2025:10:10:10 +0000] "GET /../../etc/passwd HTTP/1.1" 404 123`;
            document.getElementById('log-input').value = sample;
        }

        function analyzeLogs() {
            const input = document.getElementById('log-input').value;
            const lines = input.split('\n').filter(line => line.trim() !== '');

            let stats = {
                total: lines.length,
                ips: new Set(),
                status: {},
                attacks: []
            };

            // Regex patterns
            const ipRegex = /\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/;
            const statusRegex = /" \d{3} /;
            const attackPatterns = [
                { name: 'SQL Injection', pattern: /(' OR '1'='1|UNION SELECT|--)/i },
                { name: 'XSS', pattern: /(<script>|javascript:|onerror=)/i },
                { name: 'Path Traversal', pattern: /(\.\.\/|\.\.\\)/ },
                { name: 'Command Injection', pattern: /(; ls|; cat|\|)/ }
            ];

            lines.forEach(line => {
                // Extract IP
                const ipMatch = line.match(ipRegex);
                if (ipMatch) stats.ips.add(ipMatch[0]);

                // Extract Status
                const statusMatch = line.match(statusRegex);
                if (statusMatch) {
                    const code = statusMatch[0].replace(/"/g, '').trim();
                    stats.status[code] = (stats.status[code] || 0) + 1;
                }

                // Detect Attacks
                attackPatterns.forEach(attack => {
                    if (attack.pattern.test(line)) {
                        stats.attacks.push({
                            type: attack.name,
                            line: line,
                            ip: ipMatch ? ipMatch[0] : 'Unknown'
                        });
                    }
                });
            });

            // Update UI
            document.getElementById('stat-count').innerText = stats.total;
            document.getElementById('stat-ips').innerText = stats.ips.size;
            document.getElementById('stat-attacks').innerText = stats.attacks.length;

            // Update Threat Log
            const threatLog = document.getElementById('threat-log');
            threatLog.innerHTML = '';
            if (stats.attacks.length === 0) {
                threatLog.innerHTML = '<div class="text-gray-500 italic">No threats detected. System secure.</div>';
            } else {
                stats.attacks.forEach(attack => {
                    const div = document.createElement('div');
                    div.className = 'p-2 bg-red-900/20 border border-red-500/30 rounded';
                    div.innerHTML = `
                        <div class="flex justify-between text-red-400 font-bold">
                            <span>${attack.type}</span>
                            <span>${attack.ip}</span>
                        </div>
                        <div class="text-gray-500 truncate mt-1">${attack.line}</div>
                    `;
                    threatLog.appendChild(div);
                });
            }

            // Update Chart
            updateChart(stats.status);
        }

        function updateChart(statusData) {
            const ctx = document.getElementById('statusChart').getContext('2d');

            if (chartInstance) chartInstance.destroy();

            const codes = Object.keys(statusData);
            const data = Object.values(statusData);

            // Generate semantic colors
            const backgroundColors = codes.map(code => {
                if (code.startsWith('2')) return '#22c55e'; // Green (Success)
                if (code.startsWith('4')) return '#eab308'; // Yellow (Client Error)
                if (code.startsWith('5')) return '#ef4444'; // Red (Server Error)
                return '#3b82f6'; // Blue (Other)
            });

            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: codes,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: '#000',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#9ca3af', font: { family: 'monospace' } }
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>